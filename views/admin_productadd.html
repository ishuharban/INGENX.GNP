<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="./Style/dashboard.css">
    <script src ="./js/common.js"></script>
<style>
         body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        #mark {
    margin-top: 100px;
  }

        /* Header styles */
        #pageHeader {
            text-align: center;
            padding: 20px;
            background: #080808; /* Dark background color */
            color: white;
            font-family: 'Times New Roman', Times, serif;
            width: 100%;
            margin-top: 10px;
        }
        .container-fluid {
            padding: 20px;
        }

        /* Form styles */
        .form-label {
            font-weight: bold;
        }

        /* Table styles */
        .product-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
        }

        .product-table th, .product-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .product-table th {
            background-color: #f2f2f2;
        }

        .product-table tr:hover {
            background-color: #f5f5f5;
        }

        /* Button styles */
        button {
            padding: 5px 10px;
            background-color: #007bff; /* Blue button color */
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3; /* Darker blue color on hover */
        }

</style>
</head>
<body>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-lg fixed-top">
    <div class="container-fluid">
      <img src="./img/logo-print-hd-transparent.png" class="navbar-brand" alt="INGENX" width="120px" height="70px">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"><i class="fa-sharp fa-solid fa-bars fa-2xl"></i></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" id="home" aria-current="page" href="./home.html"><b>HOME</b></a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false" disabled>
              <b>PARTNER</b>
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item" href="./partnerApproval.html"><b>APPROVAL</b></a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="./partnerStatus.html"><b>STATUS</b></a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="./partnerSummary.html"><b>SUMMARY</b></a></li>
            </ul>
          </li>
          <!-- <li class="nav-item dropdown">
            <a class="nav-link dropdown" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false" disabled>
              <b>DEAL</b>
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item" href="./dealRegister.html"><b>REGISTER</b></a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="./dealApproval.html"><b>APPROVAL</b></a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="./dealStatus.html"><b>STATUS</b></a></li>
              <li>
            </ul>
          </li> -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false" disabled>
              <b>CONFIGURATION</b>
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item" href="./Admin-manage-users.html"><b>Status Management</b></a></li>
              <li>
                <hr class="dropdown-divider">
                <li><a class="dropdown-item" href="./admin_productadd.html"><b>ADD PRODUCT</b></a></li>
              <li>
                <!-- <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="./Admin_SalesStage.html"><b>Sales Stage</b></a></li>
              <li> -->
                <!-- <hr class="dropdown-divider"> -->
              </li> 
              <!-- <li><a class="dropdown-item" href="./dealStatus.html"><b>STATUS</b></a></li> -->
              <li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false" disabled>
              <b>COMMISSION PAYOUT</b>
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item" href="./Admintnc.html"><b>TERMS & AGREEMENTS</b></a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="./invoice.html"><b>INVOICE GENERATE</b></a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="./AdminperformanceGraph.html"><b>PERFORMANCE GRAPH</b></a></li>
            </ul>
          </li>
          <li class="nav-item dropdown profile">
            <a class="nav-link dropdown" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false" disabled>
              <b><i class="fa-solid fa-user fa-xl"></i> PROFILE</b>
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              <form method="get" action="/profile">
                <div id="profile"></div>
              </form>
              <!-- <li>
                <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="./admin-manage-users.html"><b>Manage Users</b></a></li>
                                <li>
              
              </li> -->
              <li>
                <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="./Adminpersonaldetails.html"><b>PRESONAL INFO</b></a></li>
                                <li>
              
              </li>
              <li>
                <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="./AdminSetting.html"><b>CONTACT</b></a></li>
                                <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" onclick="logout()"><b>LOGOUT</b></a></li>
            </ul>
          </li>
        </ul>
        <hr />
        <a href="http://www.ingenxtec.com/"><img src="./img/ingenxlogo.png" alt="INGENX" width="120px" height="40px"
            id="ingenxlogo"></a>
      </div>
    </div>
  </nav>
  <div class="container-fluid " id="mark">
    <h2 id="pageHeader">OPPORTUNITY & PRODUCT MANAGEMENT</h2>


  <div class="container-fluid" id="opportunitySection">
    <h2 id="opportunityHeader"></h2>

    <!-- Form for adding an Opportunity Type -->
    <div class="mt-4">
        <!-- <h2>OPPORTUNITY TYPE</h2> -->
        <form action="/addopptype" method="POST">
            <div class="mb-2">
                <label for="opptype" class="form-label">Opportunity Type:</label>
                <input type="text" id="opptype" name="opptype" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary">Add Opportunity Type</button>
        </form>
    </div>
<br>
    <!-- Table to display existing Opportunity Types -->
    <h6>OPPORTUNITY LIST</h6>
    <table class="product-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Opportunity Type</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Table rows will be dynamically populated using JavaScript -->
        </tbody>
    </table>
</div>

<div class="container-fluid" id="productSection">
    <h2 id="productHeader"></h2>

    <!-- Form for adding a product -->
    <div class="mt-4">
        <!-- <h2>Add Product</h2> -->
        <form action="/addProduct" method="POST">
            <div class="mb-2">
                <label for="productname" class="form-label">Product Name:</label>
                <input type="text" id="productname" name="productname" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary">Add Product</button>
        </form>
    </div>
<br>
    <!-- Table to display existing products -->
    <h6>Product List</h6>
    <table class="product-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Product Name</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Table rows will be dynamically populated using JavaScript -->
        </tbody>
    </table>
</div>

<script>
    async function fetchOpportunityTypes() {
        try {
            const response = await fetch('/OPPTYPES');
            const data = await response.json();
            const opportunityTypes = data;

            const tbody = document.querySelector('#opportunitySection tbody');
            tbody.innerHTML = '';

            if (!opportunityTypes.length) {
                tbody.innerHTML = '<tr><td colspan="3">No Opportunity Types found</td></tr>';
            } else {
                opportunityTypes.forEach((opportunityType) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${opportunityType._id}</td>
                        <td>${opportunityType.opptype}</td>
                        <td>
                            <button onclick="updateOpportunityType('${opportunityType._id}', '${opportunityType.opptype}')">Update</button>
                            <button onclick="deleteOpportunityType('${opportunityType._id}','${opportunityType.opptype}')">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
        } catch (error) {
            console.error(error);
        }
    }

    // Function to update an Opportunity Type
    async function updateOpportunityType(opportunityTypeId, opportunityType) {
        const updatedOpportunityType = prompt('Enter updated Opportunity Type:', opportunityType);

        if (updatedOpportunityType !== null) {
            try {
                const response = await fetch(`/updateOpptype/${opportunityTypeId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ updatedOpptype: updatedOpportunityType }),
                });

                if (response.ok) {
                    fetchOpportunityTypes();
                } else {
                    alert('Failed to update Opportunity Type');
                }
            } catch (error) {
                console.error(error);
            }
        }
    }

    // Function to delete an Opportunity Type
    async function deleteOpportunityType(opportunityTypeId,opptype) {
        if (confirm(`Are you sure you want to delete this ${opptype} Opportunity Type?`)) {
            try {
                const response = await fetch(`/deleteOppType/${opportunityTypeId}`, {
                    method: 'DELETE',
                });

                if (response.ok) {
                    fetchOpportunityTypes();
                } else {
                    alert('Failed to delete Opportunity Type');
                }
            } catch (error) {
                console.error(error);
            }
        }
    }

    async function fetchProducts() {
        try {
            const response = await fetch('/Product');
            const data = await response.json();
            const productList = data.deal;

            const tbody = document.querySelector('#productSection tbody');
            tbody.innerHTML = '';

            if (productList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3">No products found</td></tr>';
            } else {
                productList.forEach((product) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product._id}</td>
                        <td>${product.productname}</td>
                        <td>
                            <button onclick="updateProduct('${product._id}', '${product.productname}')">Update</button>
                            <button onclick="deleteProduct('${product._id}')">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
        } catch (error) {
            console.error(error);
        }
    }

    // Function to update a product
    async function updateProduct(productId, productName) {
        const updatedProductName = prompt('Enter updated product name:', productName);

        if (updatedProductName !== null) {
            try {
                const response = await fetch(`/updateProduct/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ updatedProductName }),
                });

                if (response.ok) {
                    fetchProducts(); 
                } else {
                    alert('Failed to update product');
                }
            } catch (error) {
                console.error(error);
            }
        }
    }

    // Function to delete a product
    async function deleteProduct(productId) {
        if (confirm('Are you sure you want to delete this product?')) {
            try {
                const response = await fetch(`/deleteProduct/${productId}`, {
                    method: 'DELETE',
                });

                if (response.ok) {
                    fetchProducts(); // Refresh the product list
                } else {
                    alert('Failed to delete product');
                }
            } catch (error) {
                console.error(error);
            }
        }
    }

    // Fetch and display Opportunity Types and Products when the page loads
    fetchOpportunityTypes();
    fetchProducts();
</script>
</body>
</html>
